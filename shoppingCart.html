<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <link rel="stylesheet" href="./css/header.css" />
    <link rel="stylesheet" href="./css/footer.css" />
    <link rel="stylesheet" href="./css/shoppingCart.css" />
    <link rel="stylesheet" href="./css/top.css" />
    <title>Document</title>
    <style>
      .shop {
        display: none;
      }
      .empty {
        width: 100%;
        background-color: #fff;
        display: none;
      }
      .empty img {
        margin-left: 100px;
      }
      .show {
        display: block;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <div class="top"></div>
      <header>
        <div class="header-inner cf">
          <div class="menu">
            <a href="javascript:;">
              <div class="before"></div>
              <div class="menu-toggle"></div>
              <div class="after"></div>
            </a>
          </div>
          <div class="logo">
            <h1><a href="">魔赞</a></h1>
          </div>
          <div class="shopping-cart">
            <a href="shoppingCart.html"></a>
            <span class="shop-num">0</span>
          </div>
          <div class="login">
            <a href="login.html">登录</a>
            <span>|</span>
            <a href="">注册</a>
          </div>
        </div>
        <div class="classify">
          <div class="classify-inner">
            <h2>分类</h2>
            <span></span>
            <div class="kind">
              <a href="">iPhone</a>
              <a href="">iPad</a>
              <a href="">Apple Watch</a>
              <a href="">Mac</a>
              <a href="">Beats</a>
              <a href="">Apple 配件</a>
            </div>
          </div>
        </div>
      </header>
      <section>
        <div class="main-inner">
          <div class="main-top cf">
            <p>购物车[<span class="shop-num">0</span>件]</p>
            <div>购买成功</div>
            <div>填写订单</div>
            <div class="active">购物车</div>
          </div>
          <div class="shop">
            <div class="shop-title">
              <span class="choose all-choose"></span>全选
              <span>商品</span>
              <span>单价</span>
              <span>数量</span>
              <span>小计</span>
              <span>操作</span>
            </div>
            <div class="shop-cart"></div>
            <div class="shop-foot">
              <span class="choose all-choose"></span>全选
              <span class="delete">删除</span>
              <span class="wish">转到愿望单</span>
              <span
                >共<span class="shop-num">0</span
                >件商品,</span
              >
              <span
                >已选择<span class="already-choose">0</span
                >件,</span
              >
              <span
                >共优惠&nbsp;&nbsp;<span class="discount"
                  >￥0.00</span
                ></span
              >
              <span class="sum">合计:<br />[不含运费]</span>
              <span class="summation"></span>
              <a href="javascript:;">去结算</a>
            </div>
          </div>
          <div class="empty">
            <img src="./images/shop/g-gwc-k.jpg" alt="" />
          </div>
        </div>
      </section>
      <footer>
        <div class="footer-inner cf">
          <div class="logo">
            <a href="index.html"></a>
          </div>
          <p>
            Morethan.cc All rights
            reserved.京ICP备15067340号.<br />地址：北京市朝阳区广顺北大街33号福码大厦B座601
          </p>
        </div>
      </footer>
    </div>
    <script src="./js/jquery-3.4.1.min.js"></script>
    <script src="./js/tanchaung.js"></script>
    <script src="./js/top.js"></script>
    <script>
      // 数组其实是后台给你的数据
      // 价钱个数都是数字类型
      // 前端展示的时候可以使用各种方式展示
      var goods = [
        {
          img: "./images/shop/shop1.jpg",
          name: "iPhone XR 移动联通电信4G手机 （双卡双待）",
          color: "白色",
          space: "64GB",
          price: 6499,
          num: 1,
        },
        {
          img: "./images/shop/shop2.jpg",
          name: "iPhone XS Max",
          color: "深灰空色色",
          space: "64GB",
          price: 9599,
          num: 1,
        },
        {
          img: "./images/shop/shop3.jpg",
          name: "iPhone XS",
          color: "深灰空色",
          space: "64GB",
          price: 8699,
          num: 1,
        },
        {
          img: "./images/shop/shop4.jpg",
          name: "iPhone X",
          color: "银色",
          space: "64GB",
          price: 7399,
          num: 1,
        },
        {
          img: "./images/shop/shop8.jpg",
          name: "iPhone 7 Plus",
          color: "黑色",
          space: "32GB",
          price: 4599,
          num: 1,
        },
      ]
      //生成购物车商品
      if (goods.length) {
        $(".shop").addClass("show")
        goods.forEach(function (item) {
          var goodsItem = $('<div class="goods-item cf">')
          goodsItem.html(
            `<span class="choose radio"></span><div class="phone"><a href="detail.html"><img src='${
              item.img
            }'></a>
            <div><span><a href="detail.html">${
              item.name
            }</a></span><span>颜色：${
              item.color
            }</sapn><span>容量：${
              item.space
            }</sapn></div></div>
            <span class="price" title='${item.price}'>￥${
              item.price
            }
            </span><div class="number"><button class="sub">-</button><span>${
              item.num
            }</span><button class="add">+</button></div><span class="total-price" title="${
              item.num * item.price
            }">￥${
              item.num * item.price
            }</span><span class="del"></span><div class="pan-duan"><span class="yes">确定删除</span><span class="no">不删除</span></div>`
          )
          $(".shop-cart").append(goodsItem)
        })
        //1.点击全选按钮
        var flag = true
        $(".choose").addClass("change")
        //所有人和我的状态一样
        $(".all-choose").click(function () {
          if (flag) {
            $(".choose").removeClass("change")
            getTotal($(".radio"))
            flag = false
          } else {
            $(".choose").addClass("change")
            getTotal($(".radio"))
            flag = true
          }
        })
        //2.点击单选的复选框
        $(".radio").click(function () {
          //先看当前点击的是否是未选中
          //未选中的话全选一定是未选中
          //选中的话，要看其他是否选中，选中的话 全选选中，否则全选不选中
          var state = $(this).prop("class")
          //选中的情况
          if (state !== "choose radio change") {
            $(this).addClass("change")
            //默认所有都选中
            var allChecked = true
            $(".radio").each(function () {
              //在这个函数中，$(this)指的是当前的元素
              if (
                $(this).prop("class") !==
                "choose radio change"
              ) {
                allChecked = false
                return
              }
            })
            if (allChecked) {
              $(".all-choose").addClass("change")
            }
          } else {
            $(this).removeClass("change")
            $(".all-choose").removeClass("change")
            flag = false
          }
          getTotal($(".radio"))
        })
        //3.数量的加减
        $(".sub").click(function () {
          var num = $(this).next().text()
          var price = $(this)
            .parents(".goods-item")
            .find(".price")
            .prop("title")
          console.log(price)
          if (num > 1) {
            num--
          }
          $(this).next().text(num)
          $(this)
            .parents(".goods-item")
            .find(".total-price")
            .text("￥" + num * price)
          $(this)
            .parents(".goods-item")
            .find(".total-price")
            .prop("title", num * price)
          shopNum()
          getTotal($(".radio"))
        })
        $(".add").click(function () {
          var num = $(this).prev().text()
          var price = $(this)
            .parents(".goods-item")
            .find(".price")
            .prop("title")
          console.log(price)
          num++
          $(this).prev().text(num)
          $(this)
            .parents(".goods-item")
            .find(".total-price")
            .text("￥" + num * price)
          $(this)
            .parents(".goods-item")
            .find(".total-price")
            .prop("title", num * price)
          shopNum()
          getTotal($(".radio"))
        })
        //4.删除商品
        var delBtn = false
        $(".del").click(function () {
          if (!delBtn) {
            $(this).next().show()
            delBtn = true
          } else {
            $(this).next().hide()
            delBtn = false
          }
        })
        $(".yes").click(function () {
          $(this).parents(".goods-item").remove()
          shopNum()
          getTotal($(".radio"))
        })
        $(".no").click(function () {
          $(this).parent().hide()
          delBtn = false
        })
        $(".delete").click(function () {
          $(".radio").each(function () {
            if ($(this).hasClass("change")) {
              $(this).parents(".goods-item").remove()
            }
          })
          shopNum()
          getTotal($(".radio"))
        })
        //5.共几件商品
        //最后的总数
        function shopNum() {
          var sum = 0
          $(".number span").each(function () {
            var ind = $(this).text() * 1
            sum += ind
          })
          $(".shop-num").text(sum)
        }
        shopNum()
        //6.合计
        function getTotal(allGoods) {
          //选择几件商品
          var totalNum = 0
          var totalPrice = 0
          allGoods.each(function () {
            if (
              $(this).prop("class") ===
              "choose radio change"
            ) {
              totalNum +=
                $(this)
                  .parents(".goods-item")
                  .find(".number span")
                  .text() * 1
              totalPrice +=
                $(this)
                  .parents(".goods-item")
                  .find(".total-price")
                  .prop("title") * 1
            }
          })
          $(".already-choose").text(totalNum)
          $(".summation").text("￥" + totalPrice)
          // return {
          //   totalNum: totalNum,
          //   totalPrice: totalPrice,
          // }
        }
        getTotal($(".radio"))
      } else {
        $(".empty").addClass("show")
      }
    </script>
  </body>
</html>
